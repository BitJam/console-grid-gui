#!/bin/bash

LIB_DIR=/usr/lib/shell
loc_lib=./lib
test -e $loc_lib/lib-screen.sh && LIB_DIR=$loc_lib
. $LIB_DIR/lib-menu.sh

main() {
    #grid_color_scheme light

    screen_set title1=$"antiX Audio Visual Control Centre"
    screen_set box=-s border=1
    set_title_2

    init

    hide_tty
    clear
    redraw
    main_loop
}

init() {
    screen_init
    grid_read_new antix_av "$(make_menu)"
    grid_narrow y=3 title=$"antiX Audio Visual Commands"
    grid_center_x
    grid_fill_y 15
    grid_finalize
}

antix_av_on_enter() {
    local name=$1 sel=$3
    cmd=$(echo "$name" | cut -d: -f1)

    exit_to_main "$cmd"

    case $cmd in
                 speaker-test) run_cmd     $cmd -c 2 -t wav -l 2 ;;
        alsa-set-default-card) run_cmd  -p $cmd --cli   ;;
                    alsamixer) run_cmd     $cmd         ;;    
                         mocp) run_cmd     $cmd         ;;
                          mpv) run_cmd     $cmd         ;;
                         pmrp) run_cmd     $cmd         ;;
                      burniso) run_cmd     $cmd         ;;
                          cdw) run_cmd     $cmd         ;;

        *)  db_msg "Would do action %s" "$white$cmd"
    esac
    return
}

make_menu() {
    start_menu_list
    add_cmd "speaker-test"             "See if sound is working"
    add_cmd "alsa-set-default-card"    "Select which sound card to use"
    add_cmd "alsamixer"                "simple sound mixer"
    add_cmd "mocp"                     "Audio Player"
    # add_cmd "mpv"                      "Video Player"
    add_cmd "pmrp"                     "Poor Man's Radio Player"
    # add_cmd "burniso"                  "cd/dvd burner"
    add_cmd "cdw"                      "cd/dvd/burner"

    end_menu_list
    return_to_main_entry
}

DEBUG=true
[ "$DEBUG" = "true" ] || log_file=/dev/null

main "$@" 2>> $log_file



